name: Deploy to Raspberry Pi

on:
  pull_request:
    types: [closed]
    branches: [main]

jobs:
  deploy:
    if: github.event.pull_request.merged == true
    # Matching your Pi's exact labels: 'self-hosted', 'Linux', 'ARM'
    runs-on: [self-hosted, Linux, ARM] 

    steps:
      - name: Update Code on Raspberry Pi
        run: |
          cd /opt/opensoak
          git fetch --all
          git reset --hard origin/main

      - name: Restart OpenSoak Service
        run: |
          # Restarting the service to apply code changes
          sudo systemctl restart opensoak.service || echo "Service not found or restart failed."
          echo "OpenSoak deployment complete."
